# BizLinkOne 開発ガイドライン

## 🎯 基本原則

### 1. UI 変更の制限
既存のUIは以下の場合を除いて変更しないこと:
- ✅ **許可される変更**:
  - 必要な機能が不足している場合の追加
  - 機能に矛盾が存在する場合の修正
  - バグ修正
  - パフォーマンス改善
  - アクセシビリティ向上
  - レスポンシブデザイン対応

- ❌ **禁止される変更**:
  - 既存コンポーネントの不要なリファクタリング
  - 動作している機能の再実装
  - デザインの一貫性を損なう変更
  - 既存のユーザーフローの変更（必要な場合を除く）

### 2. 追加実装の原則
- **非破壊的追加**: 既存機能を壊さずに新機能を追加
- **段階的実装**: 大きな機能は段階的に実装し、各段階でテスト
- **後方互換性**: 既存データやAPIとの互換性を保つ

### 3. コード品質基準
- **TypeScript**: 厳密な型定義を使用
- **コンポーネント**: 単一責任の原則に従う
- **再利用性**: 共通ロジックはカスタムフックやユーティリティ関数に抽出
- **テスタビリティ**: テスト可能な構造を維持

## 📁 ファイル構造規約

### コンポーネント配置
```
client/src/
├── components/          # 再利用可能なUIコンポーネント
│   ├── ui/             # shadcn/ui基本コンポーネント（変更禁止）
│   └── *.tsx           # カスタムコンポーネント
├── pages/              # ページコンポーネント
├── hooks/              # カスタムフック
├── contexts/           # React Context
├── lib/                # ユーティリティ、設定
├── locales/            # 多言語対応
└── types/              # TypeScript型定義
```

### 命名規則
- **コンポーネント**: PascalCase (例: `TaskCard.tsx`)
- **フック**: camelCase with `use` prefix (例: `useRealtimeMessages.ts`)
- **ユーティリティ**: camelCase (例: `dateHelpers.ts`)
- **定数**: UPPER_SNAKE_CASE (例: `MAX_FILE_SIZE`)

## 🔄 変更管理

### 変更前チェックリスト
- [ ] 既存の関連機能を確認
- [ ] 影響範囲を特定
- [ ] 既存のテストケースを確認
- [ ] ドキュメントを確認

### 変更後チェックリスト
- [ ] 既存機能が正常に動作することを確認
- [ ] 新機能が仕様通りに動作することを確認
- [ ] エラーハンドリングを実装
- [ ] ドキュメントを更新
- [ ] `IMPLEMENTATION_STATUS.md` を更新

## 🎨 デザイン原則

### UI/UX
- **一貫性**: 既存のデザインシステムに従う
- **レスポンシブ**: モバイル・タブレット・デスクトップ対応
- **アクセシビリティ**: ARIA属性、キーボード操作対応
- **パフォーマンス**: 不要な再レンダリングを避ける

### カラーとスタイル
- **Tailwind CSS**: 既存のユーティリティクラスを使用
- **shadcn/ui**: コンポーネントライブラリとして使用
- **ダークモード**: すべてのコンポーネントで対応
- **カスタムカラー**: `tailwind.config.ts` で定義

## 🔐 セキュリティ

### 認証・認可
- **Supabase Auth**: 認証に使用
- **RLS (Row Level Security)**: データベースレベルでの権限管理
- **ワークスペーススコープ**: すべてのデータはワークスペース単位で分離

### データ検証
- **Zod**: スキーマ定義とバリデーション
- **サーバーサイド**: すべての入力をサーバーで検証
- **クライアントサイド**: UX向上のための事前検証

## 📊 状態管理

### React Query
- **キャッシュ戦略**: `staleTime: Infinity`, retries disabled
- **無効化**: mutation後に明示的に `invalidateQueries`
- **Optimistic Updates**: UX向上のために使用

### Context API
- **AuthContext**: 認証状態、現在のワークスペース
- **LanguageContext**: 多言語対応
- **WorkspaceDataContext**: クロス機能の状態管理

## 🌐 国際化 (i18n)

### 翻訳管理
- **主言語**: 日本語 (`ja.ts`)
- **副言語**: 英語 (`en.ts`)
- **使用方法**: `t('key')` 関数を使用
- **ハードコード禁止**: すべてのユーザー向けテキストは翻訳ファイルに

### 翻訳キーの命名
```typescript
{
  "nav.dashboard": "ダッシュボード",           // ナビゲーション
  "task.status.todo": "未着手",              // エンティティ.プロパティ.値
  "button.save": "保存",                     // UI要素.アクション
  "error.network": "ネットワークエラー"       // カテゴリ.メッセージ
}
```

## 🧪 テスト

### テスト戦略
- **単体テスト**: 複雑なロジックとユーティリティ関数
- **統合テスト**: APIエンドポイントとデータフロー
- **E2Eテスト**: 主要なユーザーフロー
- **ブラウザテスト**: Playwright MCP使用

### テストファイル配置
- コンポーネントと同じディレクトリに `*.test.tsx`
- 統合テストは `tests/integration/`
- E2Eテストは `tests/e2e/`

## 📝 ドキュメント

### コードコメント
- **複雑なロジック**: なぜその実装か説明
- **公開API**: JSDocコメントを追加
- **TODO/FIXME**: Issueと紐付ける

### マークダウンファイル
- `README.md`: プロジェクト概要、セットアップ手順
- `IMPLEMENTATION_STATUS.md`: 実装進捗、完了機能
- `PHASE_*_PLAN.md`: 各フェーズの詳細計画
- `DEVELOPMENT_GUIDELINES.md`: このファイル

## 🚀 デプロイ

### ビルド前チェック
- [ ] TypeScript型エラーなし
- [ ] Lintエラーなし
- [ ] すべてのテストがパス
- [ ] 環境変数が設定済み

### 環境変数
```env
# Supabase (本番環境)
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=

# データベース (開発環境)
DATABASE_URL=
```

## 🔧 トラブルシューティング

### よくある問題
1. **HMRが動作しない**: サーバーを再起動
2. **型エラー**: `npm run typecheck` で確認
3. **ビルドエラー**: `node_modules` を削除して再インストール
4. **Supabase接続エラー**: 環境変数を確認

## 📞 サポート

### コミュニケーション
- **Issue**: バグ報告、機能リクエスト
- **Pull Request**: コードレビュー必須
- **ドキュメント**: 実装の背景を記録

## バージョン管理

### ブランチ戦略
- `main`: 本番環境
- `develop`: 開発環境
- `feature/*`: 機能追加
- `fix/*`: バグ修正

### コミットメッセージ
```
<type>(<scope>): <subject>

<body>

<footer>
```

**Types**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `style`: コードフォーマット
- `refactor`: リファクタリング
- `test`: テスト
- `chore`: その他

**例**:
```
feat(chat): Optimistic UI更新を実装

メッセージ送信前にUIを更新し、送信失敗時は自動ロールバック。
TanStack QueryのonMutateを使用。

Closes #123
```

---

**最終更新**: 2025年10月4日  
**バージョン**: 1.0.0
